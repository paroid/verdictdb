



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://docs.verdictdb.org/how_it_works/query_processing/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/verdictdb-favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Query Processing - VerdictDB Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#7e57c2">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,700|Inconsolata">
        <style>body,input{font-family:"Open Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Inconsolata","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#query-processing" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://docs.verdictdb.org/" title="VerdictDB Documentation" class="md-header-nav__button md-logo">
          
            <img src="../../images/verdictdb-logo-icon.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                VerdictDB Documentation
              </span>
              <span class="md-header-nav__topic">
                Query Processing
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/mozafari/verdictdb/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      mozafari/verdictdb
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../getting_started/quickstart/" title="Getting Started" class="md-tabs__link">
          Getting Started
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../basics/" title="How it works" class="md-tabs__link md-tabs__link--active">
          How it works
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../tutorial/setup/mysql/" title="Tutorial" class="md-tabs__link">
          Tutorial
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../reference/scrambling_syntax/" title="Reference" class="md-tabs__link">
          Reference
        </a>
      
    </li>
  

  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://docs.verdictdb.org/" title="VerdictDB Documentation" class="md-nav__button md-logo">
      
        <img src="../../images/verdictdb-logo-icon.png" width="48" height="48">
      
    </a>
    VerdictDB Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/mozafari/verdictdb/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      mozafari/verdictdb
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting_started/quickstart/" title="Quickstart" class="md-nav__link">
      Quickstart
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting_started/install/" title="Download / Install" class="md-nav__link">
      Download / Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting_started/connection/" title="Connecting to Data Sources" class="md-nav__link">
      Connecting to Data Sources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting_started/properties/" title="VerdictDB JDBC Properties" class="md-nav__link">
      VerdictDB JDBC Properties
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting_started/scrambling/" title="Creating Scrambles" class="md-nav__link">
      Creating Scrambles
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting_started/querying/" title="Simple Querying" class="md-nav__link">
      Simple Querying
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting_started/streaming/" title="Stream Querying" class="md-nav__link">
      Stream Querying
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      How it works
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        How it works
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../basics/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Query Processing
      </label>
    
    <a href="./" title="Query Processing" class="md-nav__link md-nav__link--active">
      Query Processing
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dag-construction" title="DAG Construction" class="md-nav__link">
    DAG Construction
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-regular-dag-construction" title="Step 1: regular DAG construction" class="md-nav__link">
    Step 1: regular DAG construction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-progressive-aggregation-dag-construction" title="Step 2: progressive aggregation DAG construction" class="md-nav__link">
    Step 2: progressive aggregation DAG construction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-plan-simplification" title="Step 3: plan simplification" class="md-nav__link">
    Step 3: plan simplification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-execution-cleaning" title="Step 4: Execution / Cleaning" class="md-nav__link">
    Step 4: Execution / Cleaning
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-individual-aggregates-combined" title="How Individual Aggregates Combined?" class="md-nav__link">
    How Individual Aggregates Combined?
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#avg-sum-count" title="AVG, SUM, COUNT" class="md-nav__link">
    AVG, SUM, COUNT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#min-max" title="MIN, MAX" class="md-nav__link">
    MIN, MAX
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#count-distinct" title="COUNT-DISTINCT" class="md-nav__link">
    COUNT-DISTINCT
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      Setup Databases (optional)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        Setup Databases (optional)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorial/setup/mysql/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorial/setup/spark/" title="Apache Spark" class="md-nav__link">
      Apache Spark
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorial/tpch/" title="Load TPC-H Data" class="md-nav__link">
      Load TPC-H Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      Example VerdictDB App
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        Example VerdictDB App
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorial/examples/mysql/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorial/examples/spark/" title="Apache Spark" class="md-nav__link">
      Apache Spark
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorial/advanced/" title="ML-based Analytics" class="md-nav__link">
      ML-based Analytics
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      Query Syntax
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        Query Syntax
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/scrambling_syntax/" title="Scrambling" class="md-nav__link">
      Scrambling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/query_syntax/" title="Select Query" class="md-nav__link">
      Select Query
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/javadoc/" title="Javadoc" class="md-nav__link">
      Javadoc
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dag-construction" title="DAG Construction" class="md-nav__link">
    DAG Construction
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-regular-dag-construction" title="Step 1: regular DAG construction" class="md-nav__link">
    Step 1: regular DAG construction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-progressive-aggregation-dag-construction" title="Step 2: progressive aggregation DAG construction" class="md-nav__link">
    Step 2: progressive aggregation DAG construction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-plan-simplification" title="Step 3: plan simplification" class="md-nav__link">
    Step 3: plan simplification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-execution-cleaning" title="Step 4: Execution / Cleaning" class="md-nav__link">
    Step 4: Execution / Cleaning
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-individual-aggregates-combined" title="How Individual Aggregates Combined?" class="md-nav__link">
    How Individual Aggregates Combined?
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#avg-sum-count" title="AVG, SUM, COUNT" class="md-nav__link">
    AVG, SUM, COUNT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#min-max" title="MIN, MAX" class="md-nav__link">
    MIN, MAX
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#count-distinct" title="COUNT-DISTINCT" class="md-nav__link">
    COUNT-DISTINCT
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/mozafari/verdictdb/edit/master/docs/how_it_works/query_processing.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="query-processing">Query Processing<a class="headerlink" href="#query-processing" title="Permanent link">&para;</a></h1>
<p>On this page, we describe how VerdictDB could speed up query processing. Note that for query processing, VerdictDB internally creates directed acyclic graph (DAG) representations (as described on <a href="/how_it_works/architecture">this page</a>) and use it for processing queries. The key to VerdictDB's faster query processing is how the DAG is constructed, which we describe below.</p>
<h2 id="dag-construction">DAG Construction<a class="headerlink" href="#dag-construction" title="Permanent link">&para;</a></h2>
<p>For description, we use the following example query:</p>
<div class="codehilite"><pre><span></span><span class="k">select</span> <span class="n">product</span><span class="p">,</span> <span class="k">avg</span><span class="p">(</span><span class="n">sales_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">avg_price</span>
<span class="k">from</span> <span class="p">(</span>
  <span class="k">select</span> <span class="n">product</span><span class="p">,</span> <span class="n">price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="k">as</span> <span class="n">sales_price</span>
  <span class="k">from</span> <span class="n">sales_table</span>
  <span class="k">where</span> <span class="n">order_date</span> <span class="k">between</span> <span class="nb">date</span> <span class="s1">&#39;2018-01-01&#39;</span> <span class="k">and</span> <span class="nb">date</span> <span class="s1">&#39;2018-01-31&#39;</span>
<span class="p">)</span> <span class="n">t</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">product</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">avg_price</span> <span class="k">desc</span>
</pre></div>

<p>In the above example, the inner query (projection) computes the price after discount, i.e., <code>sales_price</code>, and then the outer query (aggregation) computes the average of <code>sales_price</code>. Although this example query may be flattened into a simpler form, we intentionally use this nested form to make our description more general. Also, although VerdictDB internally parses the query (in String format) into its internal Java objects, our description will keep using the query string for easier understanding.</p>
<p>We suppose that a scramble <code>sales_table_scramble</code> has been created for the <code>sales_table</code> table, and <code>sales_table_scramble</code> contains <em>three</em> blocks. As described on <a href="/how_it_works/basics">this page</a>, each block of the scramble amounts to a random sample of the original table, i.e., <code>sales_table</code>.</p>
<h3 id="step-1-regular-dag-construction">Step 1: regular DAG construction<a class="headerlink" href="#step-1-regular-dag-construction" title="Permanent link">&para;</a></h3>
<p>The given query is decomposed into multiple queries, each of which is a flat query. Except for the root node, all other nodes include <code>create table as select ...</code> queries. The query for a parent node depends on its children.</p>
<p>Below we depict the DAG and the queries for those nodes.</p>
<!-- <div class="img-center">
  <img src="/images/dag1.png" class="img-center" />
</div> -->

<p><img alt="zoomify" class="center" src="/images/dag1.png" /></p>
<div class="codehilite"><pre><span></span><span class="c1">-- Q1</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">temp_table2</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="c1">-- Q2</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">temp_table2</span>
<span class="k">select</span> <span class="n">product</span><span class="p">,</span> <span class="k">avg</span><span class="p">(</span><span class="n">sales_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">avg_price</span>
<span class="k">from</span> <span class="n">temp_table1</span> <span class="n">t</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">product</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">avg_price</span> <span class="k">desc</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="c1">-- Q3</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">temp_table1</span>
<span class="k">select</span> <span class="n">product</span><span class="p">,</span> <span class="n">price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="k">as</span> <span class="n">sales_price</span>
<span class="k">from</span> <span class="n">sales_table_scramble</span>
<span class="k">where</span> <span class="n">order_date</span> <span class="k">between</span> <span class="nb">date</span> <span class="s1">&#39;2018-01-01&#39;</span> <span class="k">and</span> <span class="nb">date</span> <span class="s1">&#39;2018-01-31&#39;</span>
</pre></div>

<h3 id="step-2-progressive-aggregation-dag-construction">Step 2: progressive aggregation DAG construction<a class="headerlink" href="#step-2-progressive-aggregation-dag-construction" title="Permanent link">&para;</a></h3>
<p>VerdictDB converts a part of the DAG to enable progressive aggregations. The affected parts are the aggregate queries including scrambles in its from clause or the projections of scrambles. After the conversion, the DAG looks like below.</p>
<p><img alt="zoomify" class="center" src="/images/dag2.png" /></p>
<p>First, each of the projection nodes at the bottom only involves a part of the scramble. In this simple example, the single scramble is split into three projections. See that the following query includes an extra filtering predicate, i.e., <code>verdictdbblock = 0</code>, to only select the particular block.</p>
<div class="codehilite"><pre><span></span><span class="c1">-- P1</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">temp_table1</span>
<span class="k">select</span> <span class="n">product</span><span class="p">,</span> <span class="n">price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="k">as</span> <span class="n">sales_price</span>
<span class="k">from</span> <span class="n">sales_table_scramble</span>
<span class="k">where</span> <span class="n">order_date</span> <span class="k">between</span> <span class="nb">date</span> <span class="s1">&#39;2018-01-01&#39;</span> <span class="k">and</span> <span class="nb">date</span> <span class="s1">&#39;2018-01-31&#39;</span>
  <span class="k">and</span> <span class="n">verdictdbblock</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>

<p>Second, the aggregation is separately computed for each of those projections. It is important to note that the original <code>avg</code> function was converted into two separate aggregate functions, i.e., <code>sum</code> and <code>count</code>. The <code>avg</code> function value will be restored later.</p>
<div class="codehilite"><pre><span></span><span class="c1">-- A1</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">temp_table2</span>
<span class="k">select</span>
  <span class="n">product</span><span class="p">,</span>
  <span class="k">sum</span><span class="p">(</span><span class="n">sales_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">sum_price</span><span class="p">,</span>
  <span class="k">count</span><span class="p">(</span><span class="n">sales_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">count_price</span>
<span class="k">from</span> <span class="n">temp_table1</span> <span class="n">t</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">product</span><span class="p">;</span>
</pre></div>

<p>Observe that the individual aggregation nodes (A1, A2, and A3) only involves its own verdictdbblock, i.e., identified with 0, 1, and 2. To compute the exact answers, we combine those individual aggregates using additional nodes Combiners (C1 and C2). Naturally, the number of the Combiners is always one fewer than the number of individual aggregate nodes. Suppose A1 creates a temporary table <code>temp_table2</code>, A2 creates <code>temp_table3</code>, and A3 creates <code>temp_table4</code>. Then, the Combiners perform the operations as follows.</p>
<div class="codehilite"><pre><span></span><span class="c1">-- C1</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">temp_table5</span>
<span class="k">select</span>
  <span class="n">product</span><span class="p">,</span>
  <span class="k">sum</span><span class="p">(</span><span class="n">sum_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">sum_price</span><span class="p">,</span>
  <span class="k">count</span><span class="p">(</span><span class="n">count_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">count_price</span>
<span class="k">from</span> <span class="p">(</span>
  <span class="k">select</span> <span class="o">*</span>
  <span class="k">from</span> <span class="n">temp_table2</span>
  <span class="k">union</span> <span class="k">all</span>
  <span class="k">select</span> <span class="o">*</span>
  <span class="k">from</span> <span class="n">temp_table3</span><span class="p">)</span> <span class="n">t</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">product</span><span class="p">;</span>
</pre></div>

<p>The nodes also propagate some necessary metadata about the processed verdictdbblocks thus far.</p>
<p>Finally, the node S collects those aggregates, scale them appropriately, and restore the original select items.</p>
<div class="codehilite"><pre><span></span><span class="c1">-- S</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">temp_table7</span>
<span class="k">select</span> <span class="n">product</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span> <span class="o">*</span> <span class="n">sum_price</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span> <span class="o">*</span> <span class="n">count_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">avg_price</span>
<span class="k">from</span> <span class="n">temp_table5</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">product</span><span class="p">;</span>
</pre></div>

<p>In the above query (for the node S), <code>3.0 * sum_price</code> is an unbiased estimator for <code>sum(sales_price)</code>, and <code>3.0 * count_price</code> is an unbiased estimator for <code>count(sales_price)</code>. The dividing the sum by the count, we obtain the average. Note that those scaling factors differ depending on the source nodes (e.g., A1, C1, and C2).</p>
<h3 id="step-3-plan-simplification">Step 3: plan simplification<a class="headerlink" href="#step-3-plan-simplification" title="Permanent link">&para;</a></h3>
<p>VerdictDB simplifies the plan if possible. This process helps avoiding unnecessary temporary table creations.</p>
<h3 id="step-4-execution-cleaning">Step 4: Execution / Cleaning<a class="headerlink" href="#step-4-execution-cleaning" title="Permanent link">&para;</a></h3>
<p>VerdictDB executes the plan and removes the temporary tables if necessary.</p>
<h2 id="how-individual-aggregates-combined">How Individual Aggregates Combined?<a class="headerlink" href="#how-individual-aggregates-combined" title="Permanent link">&para;</a></h2>
<p>VerdictDB applies different rules for different types of aggregate functions as follows. VerdictDB relies on the state-of-the-art techniques available in the literature.</p>
<h3 id="avg-sum-count">AVG, SUM, COUNT<a class="headerlink" href="#avg-sum-count" title="Permanent link">&para;</a></h3>
<p>VerdictDB's answers are always <em>unbiased estimators</em> of the true answers. For instance, if only 10% of the data (that amounts to the 10% uniform random sample of the data) is processed, the unbiased estimator for the count function is 10 times the answer computed on the 10% of the data. This logic becomes more complex as unbiased samples (within scrambles) are used for different types of aggregate functions. VerdictDB performs these computations (and proper scaling) all automatically.</p>
<h3 id="min-max">MIN, MAX<a class="headerlink" href="#min-max" title="Permanent link">&para;</a></h3>
<p>VerdictDB's answers to min and max functions are the min and max of the data that has been processed so far. For example, if 10% of the data was processed, then VerdictDB outputs min or max among those 10% data. Of course, the answers become more accurate as more data is processed and become exact when 100% data is processed. One possible concern is that the answers based on partial data may not be very accurate especially when a tiny fraction (e.g., 0.1%) of the data has been processed. To overcome this, VerdictDB processes outliers first. As a result, even the answers at the early stages are highly accurate.</p>
<h3 id="count-distinct">COUNT-DISTINCT<a class="headerlink" href="#count-distinct" title="Permanent link">&para;</a></h3>
<p>This is in preparation.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../architecture/" title="Architecture" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Architecture
              </span>
            </div>
          </a>
        
        
          <a href="../../tutorial/setup/mysql/" title="MySQL" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                MySQL
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 The University of Michigan
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../javascripts/extra.js"></script>
      
    
    
      
    
  </body>
</html>